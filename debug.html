<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•ç‰ˆæœ¬</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        
        .test-area {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .game-map {
            position: relative;
            width: 100%;
            height: 300px;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            border-radius: 15px;
            overflow: hidden;
        }
        
        .character-2d {
            position: absolute;
            width: 60px;
            height: 60px;
            transition: all 0.5s ease;
            z-index: 10;
        }
        
        .character-sprite-2d {
            font-size: 2.5em;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        #runner2d {
            top: 30%;
            left: 10%;
            background: rgba(255, 255, 0, 0.3);
            border-radius: 50%;
        }
        
        #chaser2d {
            top: 70%;
            left: 5%;
            background: rgba(255, 0, 0, 0.3);
            border-radius: 50%;
        }
        
        .finish-area {
            position: absolute;
            top: 50%;
            right: 5%;
            transform: translateY(-50%);
            font-size: 3em;
            background: rgba(255, 255, 255, 0.9);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .controls {
            margin: 20px 0;
        }
        
        input {
            padding: 10px;
            font-size: 16px;
            margin: 5px;
        }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .info {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>æ‰“å­—è¿½é€æ¸¸æˆ - è°ƒè¯•ç‰ˆæœ¬</h1>
    
    <div class="test-area">
        <h2>æµ‹è¯•åŒºåŸŸ</h2>
        <div class="game-map">
            <div class="character-2d" id="runner2d">
                <div class="character-sprite-2d">ğŸƒ</div>
            </div>
            <div class="character-2d" id="chaser2d">
                <div class="character-sprite-2d">ğŸ‘®</div>
            </div>
            <div class="finish-area">ğŸ</div>
        </div>
        
        <div class="controls">
            <input type="text" id="testInput" placeholder="è¾“å…¥æµ‹è¯•æ–‡å­—" value="æµ‹è¯•">
            <button onclick="testTyping()">æµ‹è¯•æ‰“å­—å®Œæˆ</button>
            <button onclick="testRunnerMove()">æµ‹è¯•é€ƒè·‘è€…ç§»åŠ¨</button>
            <button onclick="testChaserMove()">æµ‹è¯•è¿½é€è€…ç§»åŠ¨</button>
            <button onclick="resetPositions()">é‡ç½®ä½ç½®</button>
        </div>
        
        <div class="info">
            <h3>è°ƒè¯•ä¿¡æ¯</h3>
            <div id="debugInfo">ç­‰å¾…æµ‹è¯•...</div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ¸¸æˆçŠ¶æ€
        let gameState = {
            selectedRole: 'runner',
            selectedDifficulty: 'medium',
            runnerPosition: { x: 10, y: 30 },
            chaserPosition: { x: 5, y: 70 },
            finishPosition: { x: 85, y: 50 },
            currentText: 'æµ‹è¯•',
            typedText: '',
            wpm: 60
        };

        const difficultySettings = {
            easy: { timeLimit: 20, speedMultiplier: 1.2 },
            medium: { timeLimit: 15, speedMultiplier: 1.0 },
            hard: { timeLimit: 12, speedMultiplier: 0.8 }
        };

        function updateDebugInfo(message) {
            const debugDiv = document.getElementById('debugInfo');
            debugDiv.innerHTML += '<br>' + message;
            console.log(message);
        }

        function testTyping() {
            const input = document.getElementById('testInput').value;
            gameState.typedText = input;
            gameState.currentText = 'æµ‹è¯•';
            
            updateDebugInfo(`è¾“å…¥æ–‡å­—: "${input}"`);
            updateDebugInfo(`ç›®æ ‡æ–‡å­—: "${gameState.currentText}"`);
            updateDebugInfo(`æ˜¯å¦åŒ¹é…: ${input === gameState.currentText}`);
            
            if (input === gameState.currentText) {
                updateDebugInfo('æ–‡å­—åŒ¹é…å®Œæˆï¼Œè°ƒç”¨ç§»åŠ¨é€»è¾‘');
                onTextComplete();
            }
        }

        function onTextComplete() {
            updateDebugInfo('=== onTextComplete å¼€å§‹ ===');
            updateDebugInfo(`å½“å‰è§’è‰²: ${gameState.selectedRole}`);
            updateDebugInfo(`WPM: ${gameState.wpm}`);
            
            const difficulty = difficultySettings[gameState.selectedDifficulty];
            const speedBonus = Math.max(1, gameState.wpm / 20) * difficulty.speedMultiplier;
            
            updateDebugInfo(`éš¾åº¦: ${gameState.selectedDifficulty}`);
            updateDebugInfo(`é€Ÿåº¦åŠ æˆ: ${speedBonus}`);
            
            if (gameState.selectedRole === 'runner') {
                updateDebugInfo('é€ƒè·‘è€…ç§»åŠ¨å‰ä½ç½®: ' + JSON.stringify(gameState.runnerPosition));
                
                const direction = {
                    x: gameState.finishPosition.x - gameState.runnerPosition.x,
                    y: gameState.finishPosition.y - gameState.runnerPosition.y
                };
                const length = Math.sqrt(direction.x * direction.x + direction.y * direction.y);
                
                updateDebugInfo(`æ–¹å‘å‘é‡: (${direction.x}, ${direction.y})`);
                updateDebugInfo(`æ–¹å‘é•¿åº¦: ${length}`);
                
                if (length > 0) {
                    gameState.runnerPosition.x += (direction.x / length) * speedBonus;
                    gameState.runnerPosition.y += (direction.y / length) * speedBonus;
                }
                
                updateDebugInfo('é€ƒè·‘è€…ç§»åŠ¨åä½ç½®: ' + JSON.stringify(gameState.runnerPosition));
            } else {
                updateDebugInfo('è¿½é€è€…ç§»åŠ¨å‰ä½ç½®: ' + JSON.stringify(gameState.chaserPosition));
                
                const direction = {
                    x: gameState.runnerPosition.x - gameState.chaserPosition.x,
                    y: gameState.runnerPosition.y - gameState.chaserPosition.y
                };
                const length = Math.sqrt(direction.x * direction.x + direction.y * direction.y);
                
                if (length > 0) {
                    gameState.chaserPosition.x += (direction.x / length) * speedBonus;
                    gameState.chaserPosition.y += (direction.y / length) * speedBonus;
                }
                
                updateDebugInfo('è¿½é€è€…ç§»åŠ¨åä½ç½®: ' + JSON.stringify(gameState.chaserPosition));
            }
            
            updateDebugInfo('æ›´æ–°2Dä½ç½®...');
            update2DPositions();
            updateDebugInfo('=== onTextComplete ç»“æŸ ===');
        }

        function update2DPositions() {
            updateDebugInfo('--- update2DPositions å¼€å§‹ ---');
            updateDebugInfo('é€ƒè·‘è€…ä½ç½®: ' + JSON.stringify(gameState.runnerPosition));
            updateDebugInfo('è¿½é€è€…ä½ç½®: ' + JSON.stringify(gameState.chaserPosition));
            
            // é™åˆ¶ä½ç½®èŒƒå›´
            gameState.runnerPosition.x = Math.max(0, Math.min(90, gameState.runnerPosition.x));
            gameState.runnerPosition.y = Math.max(10, Math.min(90, gameState.runnerPosition.y));
            gameState.chaserPosition.x = Math.max(0, Math.min(90, gameState.chaserPosition.x));
            gameState.chaserPosition.y = Math.max(10, Math.min(90, gameState.chaserPosition.y));
            
            // æ›´æ–°2Dè§’è‰²ä½ç½®
            const runnerElement = document.getElementById('runner2d');
            const chaserElement = document.getElementById('chaser2d');
            
            if (runnerElement) {
                runnerElement.style.left = `${gameState.runnerPosition.x}%`;
                runnerElement.style.top = `${gameState.runnerPosition.y}%`;
                updateDebugInfo(`è®¾ç½®é€ƒè·‘è€…DOMä½ç½®: ${gameState.runnerPosition.x}%, ${gameState.runnerPosition.y}%`);
            } else {
                updateDebugInfo('é”™è¯¯: æ‰¾ä¸åˆ°runner2då…ƒç´ ');
            }
            
            if (chaserElement) {
                chaserElement.style.left = `${gameState.chaserPosition.x}%`;
                chaserElement.style.top = `${gameState.chaserPosition.y}%`;
                updateDebugInfo(`è®¾ç½®è¿½é€è€…DOMä½ç½®: ${gameState.chaserPosition.x}%, ${gameState.chaserPosition.y}%`);
            } else {
                updateDebugInfo('é”™è¯¯: æ‰¾ä¸åˆ°chaser2då…ƒç´ ');
            }
            
            updateDebugInfo('--- update2DPositions ç»“æŸ ---');
        }

        function testRunnerMove() {
            updateDebugInfo('æ‰‹åŠ¨æµ‹è¯•é€ƒè·‘è€…ç§»åŠ¨');
            gameState.runnerPosition.x += 5;
            gameState.runnerPosition.y += 2;
            update2DPositions();
        }

        function testChaserMove() {
            updateDebugInfo('æ‰‹åŠ¨æµ‹è¯•è¿½é€è€…ç§»åŠ¨');
            gameState.chaserPosition.x += 3;
            gameState.chaserPosition.y += 1;
            update2DPositions();
        }

        function resetPositions() {
            updateDebugInfo('é‡ç½®æ‰€æœ‰ä½ç½®');
            gameState.runnerPosition = { x: 10, y: 30 };
            gameState.chaserPosition = { x: 5, y: 70 };
            update2DPositions();
            document.getElementById('debugInfo').innerHTML = 'ä½ç½®å·²é‡ç½®<br>';
        }

        // åˆå§‹åŒ–
        updateDebugInfo('è°ƒè¯•ç‰ˆæœ¬å·²åŠ è½½');
        updateDebugInfo('å½“å‰è§’è‰²: ' + gameState.selectedRole);
    </script>
</body>
</html>